<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UnexpectedReplyTypeParsers.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RedRadishes Core</a> &gt; <a href="index.source.html" class="el_package">redradishes.decoder.parser</a> &gt; <span class="el_source">UnexpectedReplyTypeParsers.java</span></div><h1>UnexpectedReplyTypeParsers.java</h1><pre class="source lang-java linenums">package redradishes.decoder.parser;

import redradishes.decoder.ArrayBuilderFactory;
import redradishes.decoder.BulkStringBuilderFactory;
import redradishes.decoder.ReplyParseException;

import javax.annotation.Nullable;
import java.nio.ByteBuffer;
import java.nio.charset.CharsetDecoder;

class UnexpectedReplyTypeParsers {
<span class="fc" id="L12">  private static final Appendable NOOP_APPENDABLE = new Appendable() {</span>
    @Override
    public Appendable append(CharSequence csq) {
<span class="nc" id="L15">      return this;</span>
    }

    @Override
    public Appendable append(CharSequence csq, int start, int end) {
<span class="nc" id="L20">      return this;</span>
    }

    @Override
    public Appendable append(char c) {
<span class="fc" id="L25">      return this;</span>
    }
  };
<span class="fc" id="L28">  private static final ReplyParser&lt;Appendable&gt; NOOP_SIMPLE_STRING_PARSER =</span>
<span class="fc" id="L29">      new CharAppendingParser&lt;&gt;(() -&gt; NOOP_APPENDABLE);</span>
<span class="fc" id="L30">  private static final Parser&lt;?&gt; NOOP_INTEGER_PARSER = LongParser.PARSER.mapToParser(num -&gt; null);</span>
<span class="fc" id="L31">  private static final BulkStringBuilderFactory&lt;?, ?&gt; NOOP_BULK_STRING_BUILDER_FACTORY = noopBulkStringBuilderFactory();</span>
<span class="fc" id="L32">  private static final ReplyParser&lt;?&gt; NOOP_BULK_STRING_PARSER =</span>
<span class="fc" id="L33">      new LenParser&lt;&gt;(len -&gt; new BulkStringParser&lt;&gt;(len, NOOP_BULK_STRING_BUILDER_FACTORY));</span>
<span class="fc" id="L34">  private static final ArrayBuilderFactory.Builder&lt;Object, ?&gt; NOOP_ARRAY_BUILDER_FACTORY = noopArrayBuilderFactory();</span>
<span class="fc" id="L35">  private static final ReplyParser&lt;?&gt; NOOP_ARRAY_PARSER = noopArrayParser();</span>
<span class="fc" id="L36">  private static final ReplyParser&lt;Object&gt; NOOP_ANY_REPLY_PARSER =</span>
      new AnyReplyParser&lt;&gt;(NOOP_SIMPLE_STRING_PARSER, NOOP_SIMPLE_STRING_PARSER, NOOP_INTEGER_PARSER,
          NOOP_BULK_STRING_PARSER, NOOP_ARRAY_PARSER);

  private final String unexpectedSimpleStringMeggage;
  private final String unexpectedBulkStringMeggage;
  private final String unexpectedIntegerMessage;
  private final String unexpectedArrayMessage;

<span class="fc" id="L45">  UnexpectedReplyTypeParsers(String expectedType) {</span>
<span class="fc" id="L46">    unexpectedSimpleStringMeggage = wrongType(&quot;simple string&quot;, expectedType);</span>
<span class="fc" id="L47">    unexpectedBulkStringMeggage = wrongType(&quot;bulk string&quot;, expectedType);</span>
<span class="fc" id="L48">    unexpectedIntegerMessage = wrongType(&quot;integer&quot;, expectedType);</span>
<span class="fc" id="L49">    unexpectedArrayMessage = wrongType(&quot;array&quot;, expectedType);</span>
<span class="fc" id="L50">  }</span>

  private static String wrongType(String actualTupe, String expectedType) {
<span class="fc" id="L53">    return String.format(&quot;Command returned %s reply while %s reply was expected&quot;, actualTupe, expectedType);</span>
  }

  &lt;T&gt; ReplyParser&lt;T&gt; simpleStringParser() {
<span class="fc" id="L57">    return NOOP_SIMPLE_STRING_PARSER.fail(new ReplyParseException(unexpectedSimpleStringMeggage));</span>
  }

  &lt;T&gt; ReplyParser&lt;T&gt; nilBulkStringParser() {
<span class="fc" id="L61">    return new LenParser&lt;&gt;(len -&gt; new BulkStringParser&lt;&gt;(len, NOOP_BULK_STRING_BUILDER_FACTORY)</span>
<span class="fc" id="L62">        .fail(new ReplyParseException(unexpectedBulkStringMeggage)));</span>
  }

  &lt;T&gt; ReplyParser&lt;T&gt; integerParser() {
<span class="fc" id="L66">    return NOOP_INTEGER_PARSER.fail(new ReplyParseException(unexpectedIntegerMessage));</span>
  }

  &lt;T&gt; ReplyParser&lt;T&gt; arrayParser() {
<span class="fc" id="L70">    return NOOP_ARRAY_PARSER.fail(new ReplyParseException(unexpectedArrayMessage));</span>
  }

  private static &lt;B, R&gt; BulkStringBuilderFactory&lt;B, R&gt; noopBulkStringBuilderFactory() {
<span class="fc" id="L74">    return new BulkStringBuilderFactory&lt;B, R&gt;() {</span>
      @Override
      public B create(int length, CharsetDecoder charsetDecoder) {
<span class="fc" id="L77">        return null;</span>
      }

      @Override
      public B append(B builder, ByteBuffer buffer, CharsetDecoder charsetDecoder) throws Exception {
<span class="fc" id="L82">        buffer.position(buffer.limit());</span>
<span class="fc" id="L83">        return builder;</span>
      }

      @Override
      public R appendLast(B builder, ByteBuffer buffer, CharsetDecoder charsetDecoder) throws Exception {
<span class="fc" id="L88">        buffer.position(buffer.limit());</span>
<span class="fc" id="L89">        return null;</span>
      }
    };
  }

  private static &lt;E, T&gt; ArrayBuilderFactory.Builder&lt;E, T&gt; noopArrayBuilderFactory() {
<span class="fc" id="L95">    return new ArrayBuilderFactory.Builder&lt;E, T&gt;() {</span>
      @Override
      public void add(@Nullable E element) {

<span class="fc" id="L99">      }</span>

      @Override
      public T build() {
<span class="fc" id="L103">        return null;</span>
      }
    };
  }

  private static ReplyParser&lt;?&gt; noopArrayParser() {
<span class="fc" id="L109">    return new LenParser&lt;&gt;(len -&gt; new ArrayParser&lt;&gt;(len, length -&gt; NOOP_ARRAY_BUILDER_FACTORY, NOOP_ANY_REPLY_PARSER));</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>